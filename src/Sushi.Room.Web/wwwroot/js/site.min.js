var Basket=function(){function t(n){n?localStorage.setItem(i,JSON.stringify(n)):localStorage.setItem(i,JSON.stringify(r));var t=e();$(".basket-products-count").html(t)}function o(){$(document).on("click",".add-product-in-basket-btn",function(){var n=+$(this).attr("data-product-id");u(n)});$(document).on("click",".remove-product-from-basket-btn",function(){var n=+$(this).attr("data-product-id");f(n)})}function n(){var n=localStorage.getItem(i);return n?JSON.parse(n):r}function u(i,r){var u=n(),e=u.filter(function(n){return n.productId===i}),f;e.length?(f=e[0],f.quantity=r?r:f.quantity+1):(r=r?r:1,u.push({productId:i,quantity:r}));t(u)}function f(i){for(var f,r=n(),u=0;u<r.length;u++)if(f=r[u],f.productId===+i){r.splice(u,1);t(r);break}}function s(i){var u=n(),f=u.filter(function(n){return n.productId===+i}),r;f.length&&(r=f[0],r.quantity=r.quantity+1);t(u)}function h(i){var u=n(),f=u.filter(function(n){return n.productId===+i}),r;f.length&&(r=f[0],r.quantity>1&&(r.quantity=r.quantity-1));t(u)}function e(){for(var i=n(),r=0,t=0;t<i.length;t++)r+=i[t].quantity;return r}function c(){return new Promise(function(t,i){$.ajax({url:Basket.getProductsUrl,method:"POST",data:{ProductIds:l()},success:function(i){var o=n(),e=i.data,r=0,u=0,f=0;$.each(e,function(n,t){t.quantity=o.filter(function(n){return n.productId===t.id})[0].quantity;r+=(t.hasDiscount?t.discountedPrice:t.price)*t.quantity});r=Math.round(r*100)/100;u=r*18/100;u=Math.round(u*100)/100;f=r+u;f=Math.round(f*100)/100;t({products:e,subTotalPrice:r,commissionPrice:u,totalPrice:f})},error:function(n){i(n)}})})}function l(){for(var u,i=n(),r=[],t=0;t<i.length;t++)u=i[t],r.push(u.productId);return r}function a(){t(r)}var i="__Basket__",r=[];return{getProductsUrl:null,init:t,addProduct:u,removeProduct:f,getBasket:n,getBasketProductsCount:e,getProductsWithSummery:c,initControls:o,clearBasket:a,increaseQuantity:s,decreaseQuantity:h}}(),BasketSidebar=function(){function n(){Basket.getProductsWithSummery().then(function(n){var t=$("#basket-sidebar-template").html(),i=Template7.compile(t),r=i(n);$("#bs-canvas-right .sidebar").remove();$("#bs-canvas-right").append(r)})}function t(){var r={offset:!1,overlay:!0,width:"330px"},t=$(".bs-offset-main"),i=$(".bs-canvas-overlay");$('[data-toggle="canvas"][aria-expanded="false"]').on("click",function(){var u=$(this).data("target"),n=$.extend({},r,$(u).data()),f=$(u).hasClass("bs-canvas-right")?"margin-right":"margin-left";return n.width==="100%"&&(n.offset=!1),$(u).css("width",n.width),n.offset&&t.length&&t.css(f,n.width),$(u+" .bs-canvas-close").attr("aria-expanded","true"),$('[data-toggle="canvas"][data-target="'+u+'"]').attr("aria-expanded","true"),n.overlay&&i.length&&i.addClass("show"),BasketSidebar.init(),!1});$(".bs-canvas-close, .bs-canvas-overlay").on("click",function(){var n,r;return $(this).hasClass("bs-canvas-close")?(n=$(this).closest(".bs-canvas"),r=$(this).add($('[data-toggle="canvas"][data-target="#'+n.attr("id")+'"]')),t.length&&t.css($(n).hasClass("bs-canvas-right")?"margin-right":"margin-left","")):(n=$(".bs-canvas"),r=$('.bs-canvas-close, [data-toggle="canvas"]'),t.length&&t.css({"margin-left":"","margin-right":""})),n.css("width",""),r.attr("aria-expanded","false"),i.length&&i.removeClass("show"),!1});$(".basket-item-quantity-input").inputSpinner({buttonsWidth:"5px"});$(".count").prop("disabled",!0);$(document).on("click",".plus",function(){var n=$(this).attr("data-product-id");Basket.increaseQuantity(n);BasketSidebar.init()});$(document).on("click",".minus",function(){var n=$(this).attr("data-product-id");Basket.decreaseQuantity(n);BasketSidebar.init()});$(document).on("click","#clear-basket-btn",function(){var n=confirm(BasketSidebar.clearBasketConfirmText);n&&(Basket.clearBasket(),BasketSidebar.init())});$(document).on("click",".remove-basket-item-btn",function(){var t=$(this).attr("data-product-id");return Basket.removeProduct(t),n(),!1})}return{clearBasketConfirmText:null,init:n,initControls:t}}();$(function(){Basket.init(Basket.getBasket());Basket.initControls();BasketSidebar.initControls()});